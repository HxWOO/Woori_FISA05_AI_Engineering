# ðŸ“… 8ì›” 8ì¼ í•™ìŠµì¼ì§€

## ðŸ” ì˜¤ëŠ˜ì˜ í•™ìŠµ ì£¼ì œ: Elasticsearch ì‹¬í™” - Nori ë¶„ì„ê¸°ì™€ Kibana í™œìš©

ì˜¤ëŠ˜ì€ Elasticsearchì˜ í•œêµ­ì–´ í˜•íƒœì†Œ ë¶„ì„ê¸° **Nori**ë¥¼ ê¹Šì´ ìžˆê²Œ ë‹¤ë£¨ê³ , **Kibana**ë¥¼ í™œìš©í•œ ë°ì´í„° ì‹œê°í™” ë° ë¶„ì„ ì‹¤ìŠµì„ ì§„í–‰í–ˆë‹¤.

> ### ðŸ’¡ ì™œ ì¤‘ìš”í• ê¹Œ?
> - **Nori ë¶„ì„ê¸°**: í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ì •í™•í•˜ê²Œ ê²€ìƒ‰í•˜ê³  ë¶„ì„í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ë„êµ¬ìž…ë‹ˆë‹¤. ì‚¬ìš©ìž ì‚¬ì „ì„ ì´ìš©í•œ ë‹¨ì–´ ì¶”ê°€, í’ˆì‚¬ íƒœê·¸ë¥¼ ì´ìš©í•œ ë¶ˆìš©ì–´ ì²˜ë¦¬ ë“± ê³ ê¸‰ ê¸°ëŠ¥ì„ í†µí•´ ê²€ìƒ‰ í’ˆì§ˆì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìžˆë‹¤.
> - **Kibana**: ë°©ëŒ€í•œ ë°ì´í„°ë¥¼ ì‹œê°ì ìœ¼ë¡œ íƒìƒ‰í•˜ê³  ì˜ë¯¸ ìžˆëŠ” ì¸ì‚¬ì´íŠ¸ë¥¼ ë°œê²¬í•˜ê²Œ í•´ì£¼ëŠ” ê°•ë ¥í•œ ëŒ€ì‹œë³´ë“œ íˆ´ì´ë‹¤. ë¡œê·¸ ë¶„ì„, ë¹„ì¦ˆë‹ˆìŠ¤ ì¸í…”ë¦¬ì „ìŠ¤, ëª¨ë‹ˆí„°ë§ ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ í™œìš©ëœë‹¤.

---

### ðŸ”¬ 1. Elasticsearch Nori ë¶„ì„ê¸° ì‹¬í™”

Nori ë¶„ì„ê¸°ì˜ ë‹¤ì–‘í•œ ì„¤ì •ê³¼ í† í° í•„í„°ë¥¼ í™œìš©í•˜ì—¬ í•œêµ­ì–´ ì²˜ë¦¬ì˜ ì •í™•ë„ë¥¼ ë†’ì¼ ìˆ˜ ìžˆë‹¤.

#### 1.1. ì‚¬ìš©ìž ì •ì˜ ë¶„ì„ê¸°(Custom Analyzer)ì™€ í† í¬ë‚˜ì´ì €

`nori_tokenizer`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìž ì •ì˜ ë¶„ì„ê¸°ë¥¼ ìƒì„±í•˜ê³ , `decompound_mode`, `discard_punctuation` ë“±ì˜ ì˜µì…˜ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì‹¤ìŠµí–ˆë‹¤.

```json
// Nori ì‚¬ìš©ìž ì •ì˜ ë¶„ì„ê¸° ì„¤ì • ì˜ˆì‹œ
PUT nori_sample
{
  "settings": {
    "index": {
      "analysis": {
        "tokenizer": {
          "nori_user_dict": {
            "type": "nori_tokenizer",
            "decompound_mode": "mixed",
            "user_dictionary": "noridict_ko.txt"
          }
        },
        "analyzer": {
          "my_analyzer": {
            "type": "custom",
            "tokenizer": "nori_user_dict"
          }
        }
      }
    }
  }
}
```

#### 1.2. ì‚¬ìš©ìž ì‚¬ì „ í™œìš©

`user_dictionary` ì˜µì…˜ì„ í†µí•´ 'ì„¸ì¢…ì‹œ'ì™€ ê°™ì€ ë³µí•©ëª…ì‚¬ë¥¼ í•˜ë‚˜ì˜ í† í°ìœ¼ë¡œ ì¸ì‹ì‹œí‚¤ê±°ë‚˜, ë¶„í•´ëœ ê²°ê³¼ë¥¼ í•¨ê»˜ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

- **ê¸°ë³¸ ë¶„ì„**: "ì„¸ì¢…ì‹œ" â†’ `ì„¸ì¢…ì‹œ` (í•˜ë‚˜ì˜ í† í°)
- **ì‚¬ì „ ì ìš© í›„ (`ì„¸ì¢…ì‹œ ì„¸ì¢… ì‹œ`)**: "ì„¸ì¢…ì‹œ" â†’ `ì„¸ì¢…ì‹œ`, `ì„¸ì¢…`, `ì‹œ` (ì—¬ëŸ¬ í† í°)

#### 1.3. Nori í† í° í•„í„° ì¢…ë¥˜ ë° í™œìš©

| í•„í„° ì¢…ë¥˜ | ì„¤ëª… | ì£¼ìš” íŒŒë¼ë¯¸í„°/ê¸°ëŠ¥ |
| :--- | :--- | :--- |
| **`nori_part_of_speech`** | íŠ¹ì • í’ˆì‚¬(POS)ë¥¼ ê°€ì§„ í† í°ì„ ì œê±°í•¨ | `stoptags`: ì œê±°í•  í’ˆì‚¬ íƒœê·¸ ë°°ì—´ (ì˜ˆ: "E", "J") |
| **`nori_readingform`** | í•œìž(Hanja)ë¡œ ëœ í† í°ì„ í•œê¸€ ë°œìŒìœ¼ë¡œ ë³€í™˜í•¨ | ì˜ˆ: "é„•æ­Œ" â†’ "í–¥ê°€" |
| **`nori_number`** | "ì‹­ë§Œì´ì²œì˜¤ë°±"ê³¼ ê°™ì€ í•œê¸€/í˜¼í•© ìˆ«ìžë¥¼ ì•„ë¼ë¹„ì•„ ìˆ«ìžë¡œ ì •ê·œí™” | ì˜ˆ: "ì‚¼ë§Œ ì´ì²œ" â†’ "32000" |
| **`synonym`** | ë™ì˜ì–´ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í•„í„° | `synonyms_path`ë¡œ ë™ì˜ì–´ íŒŒì¼ ì§€ì • |

---

### ðŸ“ˆ 2. Kibana ë°ì´í„° ì‹œê°í™” ë° ë¶„ì„

Kibanaì˜ í•µì‹¬ ê¸°ëŠ¥ë“¤ì„ ë°°ìš°ê³ , ì‹¤ì œ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì¶•í•˜ëŠ” ì‹¤ìŠµì„ ì§„í–‰í–ˆë‹¤.

#### 2.1. Kibana í•µì‹¬ ê¸°ëŠ¥

- **Discover**: Document ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ íƒìƒ‰í•˜ê³  ì¿¼ë¦¬ ë° í•„í„°ë§ì„ ìˆ˜í–‰
- **Visualize Library**: ë‹¤ì–‘í•œ ì°¨íŠ¸ë¥¼ ìƒì„±
- **Dashboard**: ìƒì„±ëœ ì‹œê°í™” ìš”ì†Œë“¤ì„ ëª¨ì•„ í•œëˆˆì— ë³¼ ìˆ˜ ìžˆëŠ” ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì„±
- **Canvas**: ì¸í¬ê·¸ëž˜í”½ ìŠ¤íƒ€ì¼ì˜ ë™ì ì¸ í”„ë ˆì  í…Œì´ì…˜ì„ ì œìž‘
- **Maps**: ìœ„ì¹˜ ê¸°ë°˜ ë°ì´í„°ë¥¼ ì§€ë„ ìœ„ì— ì‹œê°í™”

#### 2.2. ë°ì´í„° ë·° (Data View)

ì—¬ëŸ¬ ì¸ë±ìŠ¤ë¥¼ ë¬¶ì–´ì£¼ëŠ” ê°€ìƒ ì¸ë±ìŠ¤ë¡œ, Kibanaì—ì„œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ìš”ì†Œìž…ë‹ˆë‹¤. ë‚ ì§œë³„ë¡œ ë¶„ë¦¬ëœ ì¸ë±ìŠ¤(`my_index-2023-08-08`)ë“¤ì„ `my_index-*` íŒ¨í„´ìœ¼ë¡œ ë¬¶ì–´ í•˜ë‚˜ì˜ ë°ì´í„° ì†ŒìŠ¤ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìžˆê²Œ í•´ì¤€ë‹¤

![ë°ì´í„° í‹°ì–´ë§](./img/28_0.png)

#### 2.3. ì‹¤ìŠµ: ëŒ€ì‹œë³´ë“œ ë§Œë“¤ê¸°

##### ë§µ(Maps) í™œìš©

- **EMS(Elastic Maps Service)** ì˜ ê²½ê³„ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ëŒ€í•œë¯¼êµ­ ì‹œ/ë„ë³„ ë°ì´í„°ë¥¼ ì‹œê°í™”
- `Join` ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë±ìŠ¤ì˜ ì§€ì—­ í•„ë“œì™€ ì§€ë„ ê²½ê³„ì˜ ì§€ì—­ ì´ë¦„ì„ ì—°ê²°í•  ìˆ˜ë„ ìžˆì—ˆë‹¤
![ì§€ë„ ì‹œê°í™” ì˜ˆì‹œ](./img/28_1.png)

##### íƒœê·¸ í´ë¼ìš°ë“œ(Tag Cloud)

- í…ìŠ¤íŠ¸ ë°ì´í„°ì˜ ì¶œí˜„ ë¹ˆë„ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” ê¸°ëŠ¥
- íŠ¹ì • í•„ë“œ(ì˜ˆ: ì€í–‰ ì´ë¦„)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§‘ê³„í•˜ì—¬ ì–´ë–¤ ê°’ì´ ë§Žì´ ë‚˜íƒ€ë‚˜ëŠ”ì§€ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìžˆë‹¤
![íƒœê·¸ í´ë¼ìš°ë“œ ì˜ˆì‹œ](./img/28_2.png)

#### 2.4. KQL vs Lucene ì¿¼ë¦¬

Kibana ê²€ìƒ‰ì°½ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë‘ ê°€ì§€ ì¿¼ë¦¬ ì–¸ì–´ì˜ ì°¨ì´ì 

| êµ¬ë¶„ | KQL (Kibana Query Language) | Lucene |
| :--- | :--- | :--- |
| **ë¬¸ë²•** | ì‚¬ìš©ìž ì¹œí™”ì  (`field : value`) | ì „ë¬¸ê°€ìš©, ë” ë³µìž¡í•¨ (`field:value`) |
| **ë²”ìœ„** | ë¹„êµ ì—°ì‚°ìž (`>`, `<=`) ì‚¬ìš© | `[]`(í¬í•¨), `{}`(ë¯¸í¬í•¨) ì‚¬ìš© |
| **ë…¼ë¦¬** | `and`, `or`, `not` | `+`(AND), `-`(NOT), (OR) |

- **Inspect** ë©”ë‰´ë¥¼ í†µí•´ KQLë¡œ ìž‘ì„±í•œ ì¿¼ë¦¬ê°€ ì‹¤ì œ Elasticsearchì˜ **Query DSL**ë¡œ ì–´ë–»ê²Œ ë³€í™˜ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

#### 2.5. ES|QL (Elasticsearch Query Language)

- `FROM ... | WHERE ...` ì™€ ê°™ì´ íŒŒì´í”„ë¼ì´ë‹ì„ ì§€ì›í•˜ëŠ” ìƒˆë¡œìš´ ì¿¼ë¦¬ ì–¸ì–´
- ë°ì´í„° íƒìƒ‰ ë° ë³€í™˜, ì§‘ê³„ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë° ìœ ìš©í•¨
```sql
-- ES|QL ì˜ˆì‹œ
FROM banksalad-user01,banksalad-user02
| WHERE `ëŒ€ë¶„ë¥˜` == "ìƒí™œ" AND `ë©”ëª¨` == "ê°•ì„œêµ¬"
```

---

### âœ¨ ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ ìš”ì•½

- Nori ë¶„ì„ê¸°ì˜ ì‚¬ìš©ìž ì‚¬ì „ê³¼ í† í° í•„í„°ë¥¼ ì‚¬ìš©í•´ í•œêµ­ì–´ ê²€ìƒ‰ì˜ ì •í™•ë„ë¥¼ ë†’ì¼ ìˆ˜ ìžˆë‹¤.
- KibanaëŠ” ë°ì´í„° ë·°ë¥¼ í†µí•´ ì—¬ëŸ¬ ì¸ë±ìŠ¤ì˜ ë°ì´í„°ë¥¼ í†µí•©í•˜ê³ , Maps, Tag Cloud ë“± ë‹¤ì–‘í•œ ì‹œê°í™” ë„êµ¬ë¥¼ ì œê³µí•œë‹¤.
- KQLì€ ì‚¬ìš©ìž ì¹œí™”ì ì¸ ê²€ìƒ‰ ì–¸ì–´ì´ë©°, Inspect ê¸°ëŠ¥ì„ í†µí•´ ë³µìž¡í•œ Query DSLë¡œ ë³€í™˜ë˜ëŠ” ê³¼ì •ì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.
- ES|QLì€ íŒŒì´í”„ ê¸°ë°˜ì˜ ìƒˆë¡œìš´ ì¿¼ë¦¬ ì–¸ì–´ë¡œ ë°ì´í„° íƒìƒ‰ê³¼ ë¶„ì„ì„ ë”ìš± ìœ ì—°í•˜ê²Œ ë§Œë“ ë‹¤.
